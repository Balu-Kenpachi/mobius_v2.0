<mat-expansion-panel class='viewer'  [class.hidden]="!isVisible">
  	<mat-expansion-panel-header>
	    <mat-panel-title class='header'>
	      <div>Procedure</div>
	      <div class='btn-group'>
			<button (click)="addProcedure(0)">var</button>
			<button (click)="addProcedure(1)">act</button>
			<button (click)="addProcedure(2)">for</button>
			<button (click)="addProcedure(3)">if</button>
			<button (click)="addOutput()">out</button>
		  </div>
	    </mat-panel-title>
  	</mat-expansion-panel-header>
	<div class='container'>
		<tree-root #tree [nodes]='_tree' [options]='_tree_options'>
			  <ng-template #treeNodeTemplate let-prod let-index="index">

					<!-- template for data -->
					<div *ngIf="prod.data.type == 'Data'">
						<div class='data-node-template procedure'>
							<span contenteditable="true" (blur)="updateProcedure($event, prod, 'left')">
								{{prod.getLeftComponent().expression}}
							</span> 
							= 
							<span contenteditable="true" (blur)="updateProcedure($event, prod, 'right')">
								{{prod.getRightComponent().expression}}
							</span>
						</div>
					</div>

					<!-- template for action -->
					<div *ngIf="prod.data.type == 'Action'">
						<div class='data-node-template procedure'>
							<span class='editable' contenteditable="true" (blur)="updateProcedure($event, prod, 'left')">
								{{prod.getLeftComponent().expression}}
							</span> 
							=
							<span>{{prod.getRightComponent().expression}}
								(	
								<span *ngFor="let arg of prod.getRightComponent().params" contenteditable="true" (blur)="updateProcedure($event, prod, 'right')">
									{{ arg.value || arg.type }}
								</span>
								)
							</span>
						</div>
					</div>

					<!-- template for control -->
					<!-- todo -->
					<!-- <div *ngIf="prod.data.type == 'Control'">
						
						for each
						<div class='data-node-template procedure' *ngIf="prod.data.name == 'for each'">
							for 
							<span contenteditable="true" (blur)="updateProcedure($event, prod, -1)">{{ prod.data.result }}</span> 
							in 
							<span contenteditable="true" (blur)="updateProcedure($event, prod, 1)">{{prod.data.expression}}</span>
						</div>
					
						if else
						<div class='data-node-template procedure' *ngIf="prod.data.name == 'if'">
							if <span contenteditable="true" (blur)="updateProcedure($event, prod, 1)">( {{prod.data.expression}} )</span>
						</div>
					
						if / else
						<div class='data-node-template procedure' *ngIf="prod.data.name != 'for each' && prod.data.name != 'if'">
							<span>{{ prod.data.name }}</span>
						</div>
					
					</div> -->

				    <div class='btn-group'>
					    <button (click)="deleteProcedure(index, $event)">Delete</button>
					    <button (click)="disableProcedure(index, $event)">Disable</button>
					    <button (click)="go($event)">Copy</button>
					</div>

			  </ng-template>
		</tree-root>
	</div>
	<button (click)="expandAll(tree)">Expand All</button>
</mat-expansion-panel>